<template>
  <view class="login">
    <view class="main-head">
      <view class="main-head-content">
        <view class="u-demo-title u-flex">
          <u-icon name="arrow-left" :size="36" @click="$util.goback()"></u-icon>
          <view class="u-text-left u-flex-1 u-margin-left-20">
            修改密码
          </view>
        </view>
      </view>
    </view>
    <view class="main-body">
      <u-toast ref="uToast"></u-toast>
        <view class="container">
          <view class="container-input u-margin-top-30">
            <view class="u-input u-flex">
              <view class="input-label">原密码</view>
              <u-input placeholder="填写密码" :custom-style="customStyle" :border="border"  v-model="pwd.oldPassword" type="password"/>
            </view>
            <view class="u-input u-flex">
              <view class="input-label">新密码</view>
              <u-input placeholder="再次填写密码" :custom-style="customStyle"  :border="border" v-model="pwd.newPassword"  type="password" />
            </view>
          </view>
        </view>
<!--        <view class="forgetPwd">忘记密码</view>-->
        <view class="buttonStyle">
          <u-button  type="primary" class="login-b" @click="formSubmit">确认</u-button>
        </view>
<!--        <u-button data-name="reg" type="primary" class="login-b" v-if="checkreg==false">确认</u-button>-->
    </view>
  </view>

</template>
<script>
  export default {
    data() {
      return {
        show_default: 1,
        countrys: ['886', '86', '852', '62', '63', '60', '82', '81', '84'],
        selectd: 0,
        areacode: '886',
        yzmText: '发送验证码',
        bindYzmdis: false,
        mobile: '',
        checked: true,
        verify: '',
        checkreg: false,
        border: false,
        customStyle:{
          borderBottom:'none',
          lineHeight:'60upx',
        },
        pwd:{
          newPassword:undefined,
          oldPassword:undefined,
        }
      }
    },
    methods: {
      changeCountry: function (e) {
        this.selectd = e.target.value;
        this.areacode = this.countrys[e.target.value];
      },
      replacemobile: function (e) {
        this.mobile = e.target.value;
      },
      // 发送短信
      bindGet() {
        var count = 60;
        var interval = setInterval(() => {
          if (count == 1) {
            this.yzmText = '发送验证码';
            this.bindYzmdis = false;
            clearInterval(interval);
          } else {
            var count_ = --count;
            this.yzmText = '等待' + count_ + 's';
            this.bindYzmdis = true;
          }
        }, 1000);
      },
      Sendsms() {
        if (this.current == 0) {
          if (this.mobile == '') {
            uni.showToast({
              title: '填写手机号',
              icon: 'none'
            });
            return false;
          }
        }
        this.$request
          .get(this.$util.url('Login/sendSms'), {params: {mobile: this.mobile, areacode: this.areacode}})
          .then(res => {
            if (res.data.errno == 1) {
              this.bindGet();
              uni.showToast({
                title: '发送成功',
                icon: 'none'
              });
            } else {
              uni.showToast({
                title: res.data.message,
                icon: 'none'
              });
            }
          })
          .catch(err => {
          });
      },
      // 提交表单
      formSubmit() {
        var that = this;
        let pwd = that.pwd;
        // let obj = new FormData();
        if (pwd.oldPassword == '') {
          uni.showToast({
            title: '请填写原密码',
            icon: 'none'
          });
          return false;
        }
        if (pwd.newPassword == '') {
          uni.showToast({
            title: '请填写新密码',
            icon: 'none'
          });
          return false;
        }
        if (pwd.oldPassword == pwd.newPassword) {
          uni.showToast({
            title: '新密码不能与原密码相同',
            icon: 'none'
          });
          return false;
        }
        if (pwd.newPassword.length < 6) {
          uni.showToast({
            title: '密码不能小于6位',
            icon: 'none'
          });
          return false;
        }
        that.checkreg = false;
        let {newPassword,oldPassword} = pwd;
        // obj.append('newPassword',newPassword);
        // obj.append('oldPassword',oldPassword);
        console.log('是肯定发ask大哥啊，1');
        this.$request
          // .put(`/user/updatePwd`, {obj})


      .put(`/user/updatePwd?oldPassword=${oldPassword}&newPassword=${newPassword}`)
          .then(res => {

            if (res.msg == "操作成功") {
              uni.showToast({
                title: res.msg,
                success: function (res2) {
                  setTimeout(function () {
                    that.checkreg = true;
                    uni.redirectTo({
                      url: '../user/login'
                    });
                  }, 1500);
                }
              });
            } else {
              that.checkreg = true;
              uni.showToast({
                title: res.msg,
                icon: 'none'
              });
            }
          })
          .catch(err => {
          });
      }
    }
  }

</script>

<style lang="scss" scoped>

  .main-head {
    background: url('../../static/images/headTop.png') no-repeat;
    background-size: contain;

    .main-head-content {
      width: 92%;
      margin: 0 auto;
      height: 220upx;

      .u-demo-title {
        padding-top: 30upx;
        color: #ffffff;
        height: 170upx;
        line-height: 140upx;
        font-size: 34upx;
      }

      .member-info {
        padding: 72upx 0 10upx;
        align-items: center;
        border-radius: 50%;
        text-align: center;

        .member-info-name {
          font-size: 32upx;
          // color: #ffffff;
        }
      }

      .main-cate-image {
        width: 90upx;
        height: 90upx;
      }
    }
  }

  .main-body {
    width: 100%;
    .main-body-summary {
      height: 120upx;
      line-height: 100upx;

      .main-body-type {
        margin-left: 40upx;
        font-size: 30upx;
      }

      .main-body-arrow {
        color: #a6acba;
      }
    }
  }


  .container {
    padding: 20upx 30upx;
    text-align: left;
    font-size: 28 rpx;
    color: $u-content-color;
    margin: 40 upx 4% 80 upx;
    background: #ffffff;

    .container-title {
      font-weight: bold;
      color: #000000;
      font-size: 46 upx;
    }

    .reg-tag {
      color: $u-content-color;
      margin: 20 upx 0;
    }



  }

  .input-label {
    color: #1f1f1f;
    width: fit-content;
    margin: 0 30upx;
  }
  .forgetPwd{
    color: #2c9ef7;
    line-height: 30upx;
    padding-left: 30upx;
    margin-top: 30upx;
  }
  .login{
    height: 100%;
  }
  .buttonStyle{
    width: 100%;
    padding: 0 5%;
    position: absolute;
    top:50%;
    /*margin-top: 50%;*/

  }
  .login-b {
    height: 90 upx;
    width: 100%;

  }

  .xieyi {
    text-align: center;
    width: 100%;
    margin-top: 30 upx;
    font-size: 26 upx;
  }
</style>
